Modified code copied from `dart:_http`.
